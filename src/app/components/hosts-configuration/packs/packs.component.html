
<div class="kt-grid kt-grid--hor kt-grid--root">
  <div class="kt-grid__item kt-grid__item--fluid kt-grid kt-grid--ver kt-page">
    <div class="kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor kt-wrapper" id="kt_wrapper">

<div class="kt-portlet kt-portlet--mobile kt-portlet--responsive-mobile no-mar-botom">
<div class="kt-portlet__head">
<div class="kt-portlet__head-label">
  <span class="kt-portlet__head-icon">
    <i class="kt-font-brand fa fa-sliders-h"></i>
  </span>
  <h3 class="kt-portlet__head-title txt-fmly">
     Packs
  </h3>
</div>
<div class="kt-portlet__head-toolbar ">
  <div class="kt-portlet__head-wrapper">
    <div class="">
      <ng-container *AppHasRole="role.adminAccess">
      <button   *ngIf="!PackName" type="button" class="btn btn-small btn-long" data-toggle="modal" data-target="#add_pack" aria-haspopup="true" aria-expanded="false">
        <i class="fa fa-plus-square"></i>Add Pack</button>
      <!-- <appbutton *ngIf="!PackName" text="Add Pack" btnClass="btn-small" btnType="button" icon="fa-plus-square"></appbutton> -->
    </ng-container>
      <!-- <a href="javascript:void(0)" (click)="goBack()" class="btn btn-clean btn-sm" data-skin="dark" data-toggle="kt-tooltip" data-placement="top" title="Back to Previous Page">
        <i class="fas fa-chevron-left back_icon_align"></i>
        Back
      </a> -->
      <appbutton (click)="goBack()" text="Back" icon="fa-chevron-left" btnClass="btn-small-light" btnType="button"></appbutton>

      <!--Begin:: Modal-->
      <div class="modal fade" id="add_pack" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true" style="display: none; position: fixed; background-color: hsla(0, 0%, 0%, 0.45)">
        <!-- <form class="kt-form" id="kt_form" method="POST" enctype="multipart/form-data"> -->
          <form class="kt-form" id="kt_form" [formGroup]="packsfile">
          <div class="modal-dialog modal-lg" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h3 class="">Add New Pack File</h3>
              <button type="button" class="close" (click)="clearInput()" data-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <!--begin:: Widgets/Tasks -->

                <div class="row">
                  <div class="col-xl-2"></div>
                  <div class="col-xl-12">
                    <div class="kt-section kt-section--first">
                      <div class="kt-section__body">
                        <p>Learn how to format your query packs
                          <a target="_blank" href="https://osquery.readthedocs.org/en/stable/deployment/configuration/#query-packs" style="font-weight:500">here</a>.
                        </p>
                        <br>
                        <div class="form-group row">
                          <label class="col-3 col-form-label">Select a Category</label>
                          <div class="col-9">
                              <select class="kt-selectpicker form-control" id="category" formControlName="category" name="category" placeholder="Select a Category"  tabindex="-98">

                                <option value="Monitoring">Monitoring</option>
                                <option value="General">General</option>
                                <option value="Forensics and Incident Response">Forensics and Incident Response</option>
                                <option value="Compliance and Management">Compliance and Management</option>
                                <option value="Intrusion Detection">Intrusion Detection</option>
                                <option value="Others">Others</option>
                              </select>

                        </div>
                        </div>
                        <div class="form-group row">
                          <label class="col-3 col-form-label">Upload File</label>
                          <div class="custom-file col-9">
                            <input [(ngModel)]="clearValue" type="file" class="custom-input-file"  formControlName="pack" (change)="uploadFile($event)"  name="pack" id="pack">
                            <div class="pt-1">
                                <span class="description_ex">Max file size is {{maxFileSizeMb}}MB</span>
                            </div>
                          </div>
                        </div>
                        <!-- <label class=""></label> -->
                      </div>
                    </div>

                  </div>
                  <div class="col-xl-2"></div>
                </div>

              <!--end:: Widgets/Tasks -->
            </div>
            <div class="modal-footer align-center">
              <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>
              <button type="submit" (click)="onSubmit()"  data-dismiss="modal"  class="btn btn-success active">Upload</button>
            </div>
          </div>
        </div>
        </form>
      </div>
      <!--End:: Modal-->
    </div>
  </div>
</div>
</div>
<div class="no_data" style="text-align: center;margin-top: 10px;"></div>

<div *ngIf="this.pack.data?.count!==0" class="kt-portlet__body txt-fmly">

<!--Begin:: Content -->
<div class="row">
  <div class="col-md-4">
  <!--begin::Portlet-->
  <div class="kt-portlet no-mar-botom portlet-body_align">
    <div class="kt-portlet__body txt-fmly" style="padding: 0px;">
      <div class="placeholder_event" >
        <div class="ph-item" style="height: 575px;margin-bottom:25px;">
        <div class="ph-col-12">
        <div class="ph-row">
          <div class="ph-col-4 big"></div>
          <div class="ph-col-8 empty big"></div>
          <div class="ph-col-6 big"></div>
          <div class="ph-col-6 empty big"></div>
          <div class="ph-col-2 big"></div>
          <div class="ph-col-10 empty big"></div>
          <div class="ph-col-6 big"></div>
          <div class="ph-col-6 empty big"></div>
          </div>
          <div class="ph-row">
            <div class="ph-col-4 big"></div>
            <div class="ph-col-8 empty big"></div>
            <div class="ph-col-6 big"></div>
            <div class="ph-col-6 empty big"></div>
            <div class="ph-col-2 big"></div>
            <div class="ph-col-10 empty big"></div>
            <div class="ph-col-6 big"></div>
            <div class="ph-col-6 empty big"></div>
            </div>
            <div class="ph-row">
              <div class="ph-col-4 big"></div>
              <div class="ph-col-8 empty big"></div>
              <div class="ph-col-6 big"></div>
              <div class="ph-col-6 empty big"></div>
              <div class="ph-col-2 big"></div>
              <div class="ph-col-10 empty big"></div>
              <div class="ph-col-6 big"></div>
              <div class="ph-col-6 empty big"></div>
              </div>
              <div class="ph-row">
                <div class="ph-col-4 big"></div>
                <div class="ph-col-8 empty big"></div>
                </div>
            </div>
          </div>
      </div>
      <div class="show_packs_data" style="height: 645px;margin-bottom:15px;display: none;">
          <table datatable [dtOptions]="dtOptions" [dtTrigger]="dtTrigger" class="table table-hover table-checkable row-border hover" id="packstable" style="border:none !important;border-bottom: 1px solid #B8B8B8 !important">
          <thead class="d-none"></thead>
           <tbody>
             <div *ngFor="let categoryPacks of packsCategoryDictionary">
               <h3 class="fnt-green pt-2" >{{categoryPacks.category}}</h3>
               <div *ngFor="let packs of categoryPacks.packs" class="kt-notification conf-div" id="search_query-name-list" style="cursor:pointer;" data-skin="dark" data-toggle="kt-tooltip" data-placement="top" title="{{packs}}">
                    <div class="kt-notification__item-title list-group"  [ngClass]="{'active': selectedItem == packs}"   (click)='getById($event, packs,packs)' >
                       <a data-target="{{packs}}" class="kt-notification__item conf-link">
                        <div class="kt-notification__item-details txt-fmly txt-trim">
                            {{ packs}}
                        </div>
                      </a>
                    </div>
               </div>
             </div>

           </tbody>
           </table>
           <div  *ngIf="packList?.length === 0">
             <span style=" text-align: center;font-weight: 600;">
              {{errorMessage}}
             </span>
           </div>
      </div>
    </div>

  </div>
  </div>
  <div class="col-md-8 right-content-conf">
    <div class="right-conf kt-portlet no-mar-botom portlet-body_align__table" id="{{packData.name}}">
      <div class="placeholder_event" >
        <div class="kt-portlet__head ph-item" style="padding: 14px 15px 3px 13px;margin-bottom: 1px;">
          <div class="ph-col-12">
            <div class="ph-row">
              <div class="ph-col-6 big"></div>
             </div>
            </div>
        </div>
      </div>
      <div class="kt-portlet__head show_packs_data"  style="display: none;">
        <div class="kt-portlet__head-label">
          <span class="kt-portlet__head-icon">

          </span>
          <h3 class="kt-portlet__head-title" style="white-space: nowrap !important; width: 300px !important; overflow: hidden !important; text-overflow: ellipsis !important;">
            <!-- all-events-pack -->
            {{packData.name}}
          </h3>
        </div>
        <div  *AppHasRole="role.adminAccess" class="kt-portlet__head-toolbar">
          <div class="kt-portlet__head-actions">
            <i style="font-size:12px;color: #fa0303;cursor: pointer;" (click) ="deletePacks(packData.id, packData.name)" title="Packs Disable" class="fa fa fa-trash-alt"></i>
          </div>

        </div>
      </div>
      <div   class="kt-portlet__body" style="padding:10px;">

        <tag-input *AppHasRole="role.adminAccess" [theme]="'foundation-theme'" [placeholder]="'Add tags here...'" [validators]="validators" [errorMessages]="errorMessages" [(ngModel)]='packData.tags' (onAdd)="packAddTag(packData.tags,packData.id)" (onRemove)="packRemoveTag($event,packData.id)" [modelAsStrings]="true"></tag-input>
        <div *AppHasRole="role.userAccess">
          {{packData?.tags}}
        </div>
        <!-- <tag-input  [placeholder]="'Add tags here...'" [(ngModel)]='packData.tags'  ></tag-input> -->

      </div>
      <div class="placeholder_event" style="padding: 1.25rem;">
        <div class="ph-item">
        <div class="ph-col-12">
        <div class="ph-row">
          <div class="ph-col-4 big"></div>
          <div class="ph-col-8 empty big"></div>
          <div class="ph-col-6 big"></div>
          <div class="ph-col-6 empty big"></div>
          <div class="ph-col-2 big"></div>
          <div class="ph-col-10 empty big"></div>
          <div class="ph-col-6 big"></div>
          <div class="ph-col-6 empty big"></div>
          </div>
          <div class="ph-row">
            <div class="ph-col-4 big"></div>
            <div class="ph-col-8 empty big"></div>
            <div class="ph-col-6 big"></div>
            <div class="ph-col-6 empty big"></div>
            <div class="ph-col-2 big"></div>
            <div class="ph-col-10 empty big"></div>
            <div class="ph-col-6 big"></div>
            <div class="ph-col-6 empty big"></div>
            </div>
            <div class="ph-row">
              <div class="ph-col-4 big"></div>
              <div class="ph-col-8 empty big"></div>
              <div class="ph-col-6 big"></div>
              <div class="ph-col-6 empty big"></div>
              <div class="ph-col-2 big"></div>
              <div class="ph-col-10 empty big"></div>
              <div class="ph-col-6 big"></div>
              <div class="ph-col-6 empty big"></div>
              </div>
            </div>
          </div>
      </div>
      <div class="kt-portlet__body show_packs_data " style="height:560px; overflow-x:scroll; padding:1.25rem;display: none;">
        <div class="accordion accordion-solid" id="accordion-{{packData.id}}">
          <!--begin::Portlet-->
<div *ngFor="let queries of packData.queries | keyvalue" class="kt-portlet__body" style="padding: 0px;">
<!--begin::Accordion-->
<div class="card right-conf-card " style="margin-bottom: 0.3rem;">
<div class="collapsed bg-clr style-accordion-background" data-toggle="collapse" data-skin="dark" attr.data-target="#{{packData.name}}-query-{{queries.value.id}}" data-placement="top" title="{{ queries.value.name }}">
{{ queries.value.name}}
<a *AppHasRole="role.adminAccess" [routerLink] = "['query',queries.value.id,'edit']" class="query_edit" data-skin="dark" data-toggle="kt-tooltip" data-placement="top" title="Edit Packs">
<img class="pull-right" src="/assets/media/icons/edit-document.svg" height="24" width="24" alt="">
</a>
</div>

<div id="{{packData.name}}-query-{{queries.value.id}}" class="collapse" attr.data-parent="#accordion-{{packData.id}}">
<div class="card-body txt-fmly">
  <table class="table table-striped- table-bordered table-hover table-checkable">
    <tbody>
      <tr>
        <td class="head-table">Query</td>
        <td class="conf-table-val">
          <div>
            <div class="sql hljs">

            <span class="hljs-keyword desc-background_packs">{{queries.value.sql}}</span>
          </div>
          <appbutton text="Run Live" btnClass="btn-small" (click)="runAdHoc(queries.value.id)"></appbutton>
        </div>
        </td>
      </tr>
      <tr>
        <td class="head-table">Interval <span class="intrvl-fnt-md">(in secs)</span></td>
        <td class="conf-table-val">
          <div class="desc-background_packs">{{queries.value.interval}}</div>

        </td>
      </tr>
      <tr>
        <td class="head-table">Platform</td>
        <td class="conf-table-val">

          <div class="desc-background_packs">{{ queries.value.platform}}
          </div>
        </td>
      </tr>
      <tr>
        <td class="head-table">Description</td>
        <td class="conf-table-val">

          <div class="desc-background_packs truncate_packs">{{queries.value.description}}</div>
        </td>
      </tr>

      <tr>
        <td class="head-table">Version</td>
        <td>
        {{queries.value.version}}
        </td>

      </tr>
      <!-- {% endif %} -->
      <tr>
        <td class="head-table">Value</td>
        <td>
        {{queries.value.value}}
        </td>

      </tr>
      <!-- {% endif %} -->
      <tr>
        <td class="head-table">Packs</td>
        <td>
          <span class="label_pack"style="color:#6371df;font-size: 12px;font-weight: 700;word-break: break-word;" *ngFor="let pack_name of  queries.value.packs">
          <a class="fnt-green" >{{pack_name}}</a>&nbsp;
          </span>
          <!-- {% endfor %} -->
        </td>
      </tr>
      <tr >
        <td class="head-table">Tags</td>
        <td *AppHasRole="role.adminAccess">
          <tag-input [theme]="'foundation-theme'" [validators]="validators" [errorMessages]="errorMessages"  [placeholder]="'Add tags here...'" [(ngModel)]='queries.value.tags' (onAdd)="queriesAddTag(queries.value.tags,queries.value.id)" (onRemove)="queriesRemoveTag($event,queries.value.id)" [modelAsStrings]="true"></tag-input>
          <!-- <input class="tagsinput" placeholder="Add tags to schedule this query" value="{{ query.tags | map(attribute='value') | sort | join(',') }}" data-uri="{{ url_for('manage.tag_query', query_id=query.id) }}" size="23"> -->
        </td>
        <td *AppHasRole="role.userAccess" >{{queries.value.tags}}</td>
      </tr>

    </tbody>
  </table>
</div>

<!--end::Accordion-->
<!-- </div> -->
<!--end::Portlet-->

  </div>
</div>
<!--Begin:: Content -->
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
